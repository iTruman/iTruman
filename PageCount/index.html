<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/style.css">
    <title>Page Count</title>
</head>
<body>

<!-- 插入与查询 -->
<section id="container">
    <div class="tab">
        <ul> 
            <li class="curr"><h3>活 动 创 建</h3></li>
            <li><h3>活 动 查 询</h3></li>
        </ul>
    </div>  
    <div class="list">
        <dl class="insert" style="display: block;">
            <form id="insert_activity" role="form" method="" action="">
                <input type="text" class="form_control" id="insert_activity_name" placeholder="请输入活动名称 .." /><br>
                <label>预计开始时间</label><br>
                <input type="date" class="form_control" id="insert_plan_start_time"/><br>
                <label>实际开始时间</label><br>
                <input type="date" class="form_control" id="insert_real_start_time"/><br>
            </form>
            <button id="insert" type="submit" class="btn_insert">Insert</button><br>
            <label class="back_id">ID: </label>
        </dl>
        <dl class="select" >
            <div class="select_tab">
                <form id="select_activity" role="form">
                    <label>活动名称</label> 
                    <input type="text" class="form_control" id="select_activity_name" placeholder="请输入活动名称 .." />
                    <label>预计开始时间</label>
                    <input type="date" class="form_control" id="select_plan_start_time"/>
                    <label>实际开始时间</label>
                    <input type="date" class="form_control" id="select_real_start_time" />
                </form>
                <button id="select" type="submit" class="btn_insert">查 · 询</button>
            </div>
            <h4>活动信息</h4>
            <div class="act_info_list">
                <table class="table">
                    <thead>
                        <tr>
                            <td><h5>活动 ID</h5></td>
                            <td><h5>活动名称</h5></td>
                            <td><h5>预计开始时间</h5></td>
                            <td><h5>预计结束时间</h5></td>
                            <td><h5>实际开始时间</h5></td>
                            <td><h5>实际结束时间</h5></td>
                            <td><h5>创建时间</h5></td>
                            <td><h5>更新时间</h5></td>
                            <td><h5>操 作</h5></td>
                        </tr>
                    </thead>
                    <tbody class="tbody">
                    </tbody>
                </table>
            </div>
        </dl>
    </div>
</section>
<!-- 更新弹出框 -->
<section class="update_box">
    <form>
        <h5>活动 ID: <label id="box_id"></label></h5>
        <label>活 动 名 称:</label><input type="text" class="form_control" id="update_activity_name"><br>
        <label>预计开始时间:</label> <input type="date" class="form_control" id="update_plan_start_time"><br>
        <label>预计结束时间:</label> <input type="date" class="form_control" id="update_plan_end_time"><br>
        <label>实际开始时间:</label> <input type="date" class="form_control" id="update_real_start_time"><br>
        <label>实际结束时间:</label> <input type="date" class="form_control" id="update_real_end_time"><br>
        <label>创 建 时 间:</label> <input type="date" class="form_control" id="update_create_time" readonly><br>
        <label>最近更新时间:</label> <input type="date" class="form_control" id="latest_update_time" readonly><br>
    </form>
    <button id="update_conform" type="submit" class="btn_confirm">确 · 定</button>
    <button id="update_cancel" type="submit" class="btn_confirm">取 · 消</button>
</section>
<footer>
    <p>©2017</p>
</footer>                   
</body>
<script type="text/javascript" src="js/zepto-1.2.0.min.js"></script>
<script>
$(function() { 
    insert();
    select();
    update();
    changeTab();
});
  //Tab 切换
function changeTab(){
    $('.tab li').off().on('click',function () {   
        var index = $(this).index();
        $('.tab li').removeClass('curr');
        $(this).addClass('curr');
        $('.list dl').hide();
        $('.list dl').eq(index).show();
    });
};
// Insert
function insert() {
    $('#insert').off().on('click',function () {
        var activity      = $('.insert #insert_activity_name').val(),
            planStartTime = $('.insert #insert_plan_start_time').val(),
            realStartTime = $('.insert #insert_real_start_time').val();

        if (!activity || !planStartTime) {
            alert("请输入活动名称和时间"); return false;
        }else{
            $.ajax({
                type: 'GET',
                url : 'http://120.27.152.211:82/activity_config.php',
                dataType:"json",
                data: {
                    mode: "insert",
                    activity_name: activity,
                    plan_start_time: planStartTime,
                    real_start_time: realStartTime
                },
                error: function() {
                    console.log("error");   
                },
                success: function(data,status){
                    if (activity&&planStartTime) {
                        $('.back_id').text("ID: " + data);
                    }else{
                        $('.back_id').text("ID: Null");
                    }
                    console.log(status);
                }
            });
        }
    });
};
// Select
function select() {
    $('#select').off().on('click',function () {
        var selectActivity        = $('.select #select_activity_name').val();
        var selectPlanStartTime   = $('.select #select_plan_start_time').val();
        var selectRealStartTime = $('.select #select_real_start_time').val();
        $.ajax({
            type: 'GET',
            url : 'http://120.27.152.211:82/activity_config.php',
            dataType:"json",
            data: {
                mode: "select",
                activity_name: selectActivity,
                plan_start_time: selectPlanStartTime,
                create_start_time: selectRealStartTime
            },
            error: function() {
                console.log("error");   
            },
            success: function(data,status){
                var _html = '';
                $.each(data,function(k,v) {
                if (!data[k].real_start_time) {
                    data[k].real_start_time = '0000-00-00 00:00:00';
                }
                else if (!data[k].real_end_time) {
                    data[k].real_end_time = '0000-00-00 00:00:00';
                }
                _html += '<tr id="'+ k +'">'
                        + '<td>' + data[k].aid + '</td>' 
                        + '<td >' + data[k].act_nm + '</td>'
                        + '<td>' + data[k].est_start_time + '</td>'
                        + '<td>' + data[k].est_end_time + '</td>'
                        + '<td>' + data[k].real_start_time + '</td>'
                        + '<td>' + data[k].real_end_time + '</td>'
                        + '<td>' + data[k].create_time + '</td>'
                        + '<td>' + data[k].update_time + '</td>'
                        + '<td>' 
                            + '<button id="'+ data[k].aid +'" actName="'+ data[k].act_nm +'" planStartTime="'+ data[k].est_start_time +'" PlanEndTime="'+ data[k].est_end_time +'"  CreateTime="'+ data[k].create_time +'"class="btn_update">' + '更新' 
                            +'</button>' 
                        + '</td>'
                    + '</tr>';
                });
                if (_html === '') {
                    alert("抱歉，没有相关活动！");
                }
                else{
                    $('.tbody').html(_html);
                }
            }
        });
    });
};
// update
function update() {
    $('.tbody').off().on('click','button',function () {
        var actId = parseInt($(this).attr('id')),
            actName  = $(this).attr('actName'),
            planStart = $(this).attr('planStartTime').slice(0,10),
            createTime = $(this).attr('CreateTime').slice(0,10);
        $('#box_id').text(actId);
        $('#update_activity_name').val(actName);
        $('#update_plan_start_time').val(planStart);
        $('#update_create_time').val(createTime);
        $('#container').hide(100);
        $('.update_box').show(600);
        // 确认更新
        $('#update_conform').off().on('click',function () {
            var updateActivityId    = actId,
                updateActivityName  = $('#update_activity_name').val(),
                updatePlanStartTime = $('#update_plan_start_time').val();
                updatePlanEndTime   = $('#update_plan_end_time').val();
             $.ajax({
                type: 'GET',
                url : 'http://120.27.152.211:82/activity_config.php',
                dataType:"json",
                data: {
                    mode: "update",
                    aid: updateActivityId, // 必要参数
                    activity_name: updateActivityName,
                    plan_start_time: updatePlanStartTime,
                    plan_end_time: updatePlanEndTime
                },
                error: function() {
                    console.log("error");   
                },
                success:function (data,status) {
                    alert("更新成功！");
                }
            });
            $('.update_box').hide();
            $('#container').show();
        
        }); 
        //取消更新
        $('#update_cancel').off().on('click',function () {
            $('.update_box').hide();
            $('#container').show();
        });
    });
};
</script>

</html>